import os
import pefile
import hashlib

def Searsch_using_MD5():
    user_input = input("Enter the letter of partion\n>>")
    user_input2 = input("Enter MD5 Hash\n>>")
    dir_path = os.path.dirname(user_input)
    for root, dirs,files in os.walk(dir_path):
        for file in files:


            if file.endswith('.exe'):
                path=root + '\\' + str(file)
                try:
                    #file1 = pefile.PE(path)
                    with open(path,"rb") as f:
                        bytes = f.read()
                        readable_hash = hashlib.md5(bytes).hexdigest()

                except Exception:
                    continue

                if readable_hash==str(user_input2).lower() :
                     print(path)

    print("\n[+] Done")
    var = input("[!] the search has been finished if you want exit Press 'Y'\n>>")
    if "Y" in var or "y" in var:
        exit()

def Searsch_using_Path_of_program():
    user_input = input("Enter the letter of partion\n>>")
    user_input2 = input("Enter the Path of malware\n>>")
    file=pefile.PE(user_input2)
    Impfile=file.get_imphash()
    dir_path = os.path.dirname(user_input2)
    for root, dirs,files in os.walk(dir_path):
        for file in files:


            if file.endswith('.exe'):
                path=root + '\\' + str(file)
                try:
                    file1 = pefile.PE(path)
                except Exception:
                    continue

                if file1.get_imphash()==Impfile:

                     print(path)

    print("\n[+] Done")
    var = input("[!] the search has been finished if you want exit Press 'Y'\n>>")
    if "Y" in var or "y" in var:
        exit()


if __name__ == "__main__":


    print("###This is a simple tool to search about malware###\n1-search by MD5 hash \n2-Search using the path of malware")

    choice=input("               ----Please Enter your choice----\n>>")
    if choice == "1":
     Searsch_using_MD5()

    elif choice=="2":
     Searsch_using_Path_of_program()

